<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="LiWuK0jxrq55oR5-aNOK6r0wFuUC8EvSlpNYhiiBkDk">
  <meta name="baidu-site-verification" content="code-MRwc3a52M3">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"zhengjun.top","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.8.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.json","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>
<meta name="description" content="C++，golang，Java，Python，Kotlin，区块链，全栈">
<meta property="og:type" content="website">
<meta property="og:title" content="郑君的学习笔记">
<meta property="og:url" content="http://zhengjun.top/page/24/index.html">
<meta property="og:site_name" content="郑君的学习笔记">
<meta property="og:description" content="C++，golang，Java，Python，Kotlin，区块链，全栈">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="郑  君">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://zhengjun.top/page/24/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/24/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>郑君的学习笔记</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">
<!-- hexo injector head_end end --><link rel="alternate" href="/atom.xml" title="郑君的学习笔记" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">郑君的学习笔记</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">要比昨天进步一点点</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">215</span></a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">80</span></a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">1285</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="郑  君"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">郑  君</p>
  <div class="site-description" itemprop="description">C++，golang，Java，Python，Kotlin，区块链，全栈</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">1285</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">80</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">215</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/ZhengHanYunBlog" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ZhengHanYunBlog" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:zhenghanyun2021@126.com" title="E-Mail → mailto:zhenghanyun2021@126.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.youtube.com/channel/UCmh8TlSil0IrCA-AQ9Xx9_Q" title="YouTube → https:&#x2F;&#x2F;www.youtube.com&#x2F;channel&#x2F;UCmh8TlSil0IrCA-AQ9Xx9_Q" rel="noopener" target="_blank"><i class="fab fa-youtube fa-fw"></i>YouTube</a>
      </span>
  </div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://zhengjun.top/2020/06/05/%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/CPP/cpp-%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="郑  君">
      <meta itemprop="description" content="C++，golang，Java，Python，Kotlin，区块链，全栈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="郑君的学习笔记">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/06/05/%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/CPP/cpp-%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/" class="post-title-link" itemprop="url">cpp-共享内存</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-06-05 10:58:39 / 修改时间：11:28:38" itemprop="dateCreated datePublished" datetime="2020-06-05T10:58:39+08:00">2020-06-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/c/" itemprop="url" rel="index"><span itemprop="name">c++</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">LPVOID lpBase;</span><br><span class="line">HANDLE hMapFile;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">load_mmp_file</span><span class="params">(<span class="keyword">const</span> wstring&amp; filePath)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="function">scope_filePtr <span class="title">file</span><span class="params">(filePath, <span class="string">L&quot;rb&quot;</span>)</span></span>;</span><br><span class="line">	<span class="keyword">uint32_t</span> size = file.<span class="built_in">fileSize</span>();</span><br><span class="line">	unique_ptr&lt;<span class="keyword">char</span>[]&gt; spBuf = make_unique&lt;<span class="keyword">char</span>[]&gt;(size + <span class="number">1</span>);</span><br><span class="line">	file.<span class="built_in">read</span>(spBuf.<span class="built_in">get</span>(), size, <span class="number">1</span>, size);</span><br><span class="line">	file.<span class="built_in">close</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Create a memory-mapped file (MMF)</span></span><br><span class="line">	<span class="comment">// 创建共享文件句柄 </span></span><br><span class="line">	hMapFile = <span class="built_in">CreateFileMapping</span>(</span><br><span class="line">		INVALID_HANDLE_VALUE,   <span class="comment">// 物理文件句柄</span></span><br><span class="line">		<span class="literal">NULL</span>,   <span class="comment">// 默认安全级别</span></span><br><span class="line">		PAGE_READWRITE,   <span class="comment">// 可读可写</span></span><br><span class="line">		<span class="number">0</span>,   <span class="comment">// 高位文件大小</span></span><br><span class="line">		size,   <span class="comment">// 地位文件大小</span></span><br><span class="line">		<span class="string">L&quot;ShareMemory&quot;</span>   <span class="comment">// 共享内存名称</span></span><br><span class="line">		);</span><br><span class="line">	<span class="comment">// 映射缓存区视图 , 得到指向共享内存的指针</span></span><br><span class="line">	lpBase = <span class="built_in">MapViewOfFile</span>(</span><br><span class="line">		hMapFile,            <span class="comment">// 共享内存的句柄</span></span><br><span class="line">		FILE_MAP_ALL_ACCESS, <span class="comment">// 可读写许可</span></span><br><span class="line">		<span class="number">0</span>,</span><br><span class="line">		<span class="number">0</span>,</span><br><span class="line">		size</span><br><span class="line">		);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 将数据拷贝到共享内存</span></span><br><span class="line">	<span class="built_in">memcpy</span>((<span class="keyword">char</span>*)lpBase, spBuf.<span class="built_in">get</span>(), size);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> size;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解除文件映射</span></span><br><span class="line"><span class="built_in">UnmapViewOfFile</span>(lpBase);</span><br><span class="line"><span class="comment">// 关闭内存映射文件对象句柄</span></span><br><span class="line"><span class="built_in">CloseHandle</span>(hMapFile);</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 打开共享的文件对象</span></span><br><span class="line">HANDLE hMapFile = <span class="built_in">OpenFileMapping</span>(FILE_MAP_ALL_ACCESS,<span class="literal">NULL</span>,<span class="string">L&quot;ShareMemory&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (hMapFile)</span><br><span class="line">&#123;</span><br><span class="line">	LPVOID lpBase = <span class="built_in">MapViewOfFile</span>(hMapFile,FILE_MAP_ALL_ACCESS,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">	<span class="comment">// 将共享内存数据拷贝出来</span></span><br><span class="line">	<span class="keyword">char</span> szBuffer[BUF_SIZE] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	<span class="built_in">strcpy</span>(szBuffer,(<span class="keyword">char</span>*)lpBase);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>,szBuffer);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 解除文件映射</span></span><br><span class="line">	<span class="built_in">UnmapViewOfFile</span>(lpBase);</span><br><span class="line">	<span class="comment">// 关闭内存映射文件对象句柄</span></span><br><span class="line">	<span class="built_in">CloseHandle</span>(hMapFile);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// 打开共享内存句柄失败</span></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;OpenMapping Error&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://zhengjun.top/2020/06/05/%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/python-System-V-style-shared-memory/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="郑  君">
      <meta itemprop="description" content="C++，golang，Java，Python，Kotlin，区块链，全栈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="郑君的学习笔记">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/06/05/%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/python-System-V-style-shared-memory/" class="post-title-link" itemprop="url">python-System V style shared memory</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-06-05 08:43:27 / 修改时间：11:02:10" itemprop="dateCreated datePublished" datetime="2020-06-05T08:43:27+08:00">2020-06-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Language/" itemprop="url" rel="index"><span itemprop="name">Language</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>760</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://docs.python.org/3/library/multiprocessing.shared_memory.html">doc</a></p>
<p>This support allows creation of memory segments that can be shared between Python processes and, consequently, help avoid (de)serialization costs when sharing data between processes.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">shm = shared_memory.SharedMemory(create=<span class="literal">False</span>, size=a.nbytes,name=<span class="string">&#x27;ShareMemory&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(shm.buf))</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">memoryview</span>&#x27;&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">datas</span> =<span class="title">shm</span>.<span class="title">buf</span>.<span class="title">tobytes</span>()</span></span><br><span class="line"><span class="class"><span class="title">print</span>(<span class="params"><span class="built_in">type</span>(<span class="params">datas</span>)</span>)</span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> &#x27;<span class="title">bytes</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure>

<p>Things to Remember</p>
<ul>
<li>The memoryview built-in type provides a zero-copy interface for reading and writing slices of objects that support Python’s high performance buffer protocol.</li>
<li>The bytearray built-in type provides a mutable bytes-like type that can be used for zero-copy data reads with functions like socket.recv_from.</li>
<li>A memoryview can wrap a bytearray, allowing for received data to be spliced into an arbitrary buffer location without copying costs.</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://zhengjun.top/2020/06/04/%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/python-logging/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="郑  君">
      <meta itemprop="description" content="C++，golang，Java，Python，Kotlin，区块链，全栈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="郑君的学习笔记">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/06/04/%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/python-logging/" class="post-title-link" itemprop="url">python-logging</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-06-04 16:13:04" itemprop="dateCreated datePublished" datetime="2020-06-04T16:13:04+08:00">2020-06-04</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-16 12:44:08" itemprop="dateModified" datetime="2021-04-16T12:44:08+08:00">2021-04-16</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Language/" itemprop="url" rel="index"><span itemprop="name">Language</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="每天一个日志文件"><a href="#每天一个日志文件" class="headerlink" title="每天一个日志文件"></a>每天一个日志文件</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init_log</span>(<span class="params">self</span>):</span></span><br><span class="line">    self.log = logging.getLogger(<span class="string">&#x27;tkArc&#x27;</span>)</span><br><span class="line">    self.log.setLevel(logging.DEBUG)</span><br><span class="line">    <span class="comment"># Add the log message handler to the logger</span></span><br><span class="line">    handler = logging.handlers.TimedRotatingFileHandler(<span class="string">&#x27;./tkArc.log&#x27;</span>, when=<span class="string">&#x27;midnight&#x27;</span>)</span><br><span class="line">    logdf = logging.Formatter(<span class="string">&#x27;$asctime $name $&#123;levelname&#125; $message&#x27;</span>, style=<span class="string">&#x27;$&#x27;</span>)</span><br><span class="line">    handler.setFormatter(logdf)</span><br><span class="line">    self.log.addHandler(handler)</span><br></pre></td></tr></table></figure>

<h2 id="循环记录日志"><a href="#循环记录日志" class="headerlink" title="循环记录日志"></a>循环记录日志</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> logging.handlers</span><br><span class="line"></span><br><span class="line">my_logger = logging.getLogger(<span class="string">&#x27;fireworks_plugin&#x27;</span>)</span><br><span class="line">my_logger.setLevel(logging.DEBUG)</span><br><span class="line"><span class="comment"># Add the log message handler to the logger</span></span><br><span class="line">handler = logging.handlers.RotatingFileHandler(</span><br><span class="line">    <span class="string">&#x27;fireworks_plugin.log&#x27;</span>, maxBytes=<span class="number">1024</span>*<span class="number">1000</span>*<span class="number">10</span>, backupCount=<span class="number">5</span>)</span><br><span class="line">df = logging.Formatter(<span class="string">&#x27;$asctime $name $&#123;levelname&#125; $message&#x27;</span>, style=<span class="string">&#x27;$&#x27;</span>)</span><br><span class="line">handler.setFormatter(df)</span><br><span class="line">my_logger.addHandler(handler)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    my_logger.warning(<span class="string">&#x27;This is a warning&#x27;</span>)</span><br><span class="line">    my_logger.debug(<span class="string">&#x27;This is a debuging&#x27;</span>)</span><br><span class="line">    my_logger.info(<span class="string">&#x27;This is a info&#x27;</span>)</span><br><span class="line">    my_logger.error(<span class="string">&#x27;This is a error&#x27;</span>)</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://zhengjun.top/2020/06/04/%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/CPP/cpp-%E5%92%8Cpython%E8%BF%9B%E7%A8%8B%E9%80%9A%E8%AE%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="郑  君">
      <meta itemprop="description" content="C++，golang，Java，Python，Kotlin，区块链，全栈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="郑君的学习笔记">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/06/04/%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/CPP/cpp-%E5%92%8Cpython%E8%BF%9B%E7%A8%8B%E9%80%9A%E8%AE%AF/" class="post-title-link" itemprop="url">cpp-和python进程通讯</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-06-04 15:29:38 / 修改时间：15:30:20" itemprop="dateCreated datePublished" datetime="2020-06-04T15:29:38+08:00">2020-06-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/c/" itemprop="url" rel="index"><span itemprop="name">c++</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>7</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>使用 nng 通讯</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://zhengjun.top/2020/06/03/%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/flask/flask%E8%82%A1%E7%A5%A8%E9%A1%B9%E7%9B%AE001-%E5%BB%BA%E7%AB%8B%E9%A1%B9%E7%9B%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="郑  君">
      <meta itemprop="description" content="C++，golang，Java，Python，Kotlin，区块链，全栈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="郑君的学习笔记">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/06/03/%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/flask/flask%E8%82%A1%E7%A5%A8%E9%A1%B9%E7%9B%AE001-%E5%BB%BA%E7%AB%8B%E9%A1%B9%E7%9B%AE/" class="post-title-link" itemprop="url">flask股票项目001-建立项目</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-06-03 20:58:40" itemprop="dateCreated datePublished" datetime="2020-06-03T20:58:40+08:00">2020-06-03</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-06-11 22:03:02" itemprop="dateModified" datetime="2020-06-11T22:03:02+08:00">2020-06-11</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%90%8E%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">后端</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%90%8E%E7%AB%AF/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>4k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>4 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>用来提供股票相关操作和信息<br>已经安装 anaconda </p>
<h2 id="创建虚拟环境"><a href="#创建虚拟环境" class="headerlink" title="创建虚拟环境"></a>创建虚拟环境</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">conda create --name flask_stocks python=3.8 flask</span><br></pre></td></tr></table></figure>

<p>使用 pycharm 创建项目，运行起来可以看到 hello world </p>
<h2 id="构建程序结构"><a href="#构建程序结构" class="headerlink" title="构建程序结构"></a>构建程序结构</h2><blockquote>
<ol>
<li>新建一个python package - “src”，用来放我们的程序，下面的操作都在src下面</li>
<li>把static和templates移到src下面</li>
<li>新建一个python package - “site”，用来放网页处理部分</li>
<li>新建一个python package - “api”，用来放api接口</li>
<li>新建一个python package - “admin”，用来放后台管理部分</li>
<li>static下面建立目录-css/images/js，css和js下面建立目录ext用来放第三方的库</li>
<li>把static目录复制到src/admin, src/site下面</li>
<li>新建一个python package - “models”，用来放数据模型</li>
<li>在src，src/admin，src/site下面新建目录 - “templates”</li>
</ol>
</blockquote>
<p><code>src/templates</code>用来放公共模板。各自蓝图下面的templates放各自的模板，<br><code>src/static</code>也是用来放公共资源的，各自蓝图下面的static放各自使用的静态资源。</p>
<p>目录结构如下：</p>
<img alt="20200603_211854.png" src="/2020/06/03/%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/flask/flask%E8%82%A1%E7%A5%A8%E9%A1%B9%E7%9B%AE001-%E5%BB%BA%E7%AB%8B%E9%A1%B9%E7%9B%AE/20200603_211854.png" width="400" height>

<h2 id="建立配置文件"><a href="#建立配置文件" class="headerlink" title="建立配置文件"></a>建立配置文件</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># config.py</span></span><br><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> timedelta</span><br><span class="line"></span><br><span class="line">basedir = os.path.abspath(os.path.dirname(__file__))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Config</span>:</span></span><br><span class="line">    DEBUG = <span class="literal">False</span></span><br><span class="line">    TESTING = <span class="literal">False</span></span><br><span class="line">    <span class="comment"># 登录设置 session cookie使用</span></span><br><span class="line">    SECRET_KEY = os.environ.get(<span class="string">&#x27;SECRET_KEY&#x27;</span>) <span class="keyword">or</span> <span class="string">&#x27;AllthingsWORKtogherFORGoOd&#x27;</span></span><br><span class="line">    UPLOAD_FOLDER = <span class="string">&#x27;static/upload&#x27;</span></span><br><span class="line">    <span class="comment"># database config</span></span><br><span class="line">    <span class="comment"># mysql+pymysql://name:password@localhost/db_name</span></span><br><span class="line">    SQLALCHEMY_DATABASE_URI = os.environ.get(</span><br><span class="line">        <span class="string">&#x27;DEV_DATABASE_URL&#x27;</span>) <span class="keyword">or</span> <span class="string">&#x27;mysql+pymysql://root:mysql@localhost:3306/books&#x27;</span></span><br><span class="line">    SQLALCHEMY_COMMIT_ON_TEARDOWN = <span class="literal">True</span></span><br><span class="line">    SQLALCHEMY_TRACK_MODIFICATIONS = <span class="literal">False</span></span><br><span class="line">    FLASKY_ADMIN = os.environ.get(<span class="string">&#x27;FLASKY_ADMIN&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">init_app</span>(<span class="params">app</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DevelopmentConfig</span>(<span class="params">Config</span>):</span></span><br><span class="line">    DEBUG = <span class="literal">True</span></span><br><span class="line">    send_file_max_age_default = timedelta(seconds=<span class="number">1</span>)</span><br><span class="line">    use_reloader = <span class="literal">True</span></span><br><span class="line">    TEMPLATES_AUTO_RELOAD = <span class="literal">True</span></span><br><span class="line">    SQLALCHEMY_DATABASE_URI = os.environ.get(</span><br><span class="line">        <span class="string">&#x27;DEV_DATABASE_URL&#x27;</span>) <span class="keyword">or</span> <span class="string">&#x27;mysql+pymysql://root:mysql@localhost:3306/books&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestingConfig</span>(<span class="params">Config</span>):</span></span><br><span class="line">    TESTING = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProductionConfig</span>(<span class="params">Config</span>):</span></span><br><span class="line">    SQLALCHEMY_DATABASE_URI = os.environ.get(</span><br><span class="line">        <span class="string">&#x27;DEV_DATABASE_URL&#x27;</span>) <span class="keyword">or</span> <span class="string">&#x27;mysql+pymysql://root:mysql@localhost:3306/books&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">config = &#123;</span><br><span class="line">    <span class="string">&#x27;development&#x27;</span>: DevelopmentConfig,</span><br><span class="line">    <span class="string">&#x27;testing&#x27;</span>: TestingConfig,</span><br><span class="line">    <span class="string">&#x27;production&#x27;</span>: ProductionConfig,</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>: DevelopmentConfig</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="建立应用"><a href="#建立应用" class="headerlink" title="建立应用"></a>建立应用</h2><p>在 src/admin，src/site，下面建立 routes_site.py 做网站路由处理，routes_api.py 做各自的 api 服务<br>src/api 下面建立 routes_api.py 做公共 api 服务</p>
<p>增加蓝图路由</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># src/admin/__init__.py</span></span><br><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Blueprint</span><br><span class="line"></span><br><span class="line">admin = Blueprint(<span class="string">&#x27;admin&#x27;</span>, __name__, template_folder=<span class="string">&#x27;templates&#x27;</span>,static_folder=<span class="string">&#x27;static&#x27;</span>,</span><br><span class="line">                  static_url_path=<span class="string">&#x27;/admin/static&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> routes_site, routes_api</span><br><span class="line"></span><br><span class="line"><span class="comment"># src/api/__init__.py</span></span><br><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Blueprint</span><br><span class="line"></span><br><span class="line">api = Blueprint(<span class="string">&#x27;api&#x27;</span>, __name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># src/site/__init__.py</span></span><br><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Blueprint</span><br><span class="line"></span><br><span class="line">site = Blueprint(<span class="string">&#x27;site&#x27;</span>, __name__, template_folder=<span class="string">&#x27;templates&#x27;</span>, static_folder=<span class="string">&#x27;static&#x27;</span>, static_url_path=<span class="string">&#x27;/site/static&#x27;</span>)</span><br><span class="line">site_api = Blueprint(<span class="string">&#x27;site_api&#x27;</span>, __name__, template_folder=<span class="string">&#x27;templates&#x27;</span>, static_folder=<span class="string">&#x27;static&#x27;</span>,</span><br><span class="line">                     static_url_path=<span class="string">&#x27;/site/static&#x27;</span>)</span><br><span class="line">                     </span><br><span class="line"><span class="comment"># 末尾导入是为了避免循环导入依赖</span></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> routes_site, routes_api</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># src/__init__.py</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用工厂函数创建实例</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> config <span class="keyword">import</span> config</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_app</span>(<span class="params">config_name</span>):</span></span><br><span class="line">    app = Flask(__name__)</span><br><span class="line">    app.config.from_object(config[config_name])</span><br><span class="line">    config[config_name].init_app(app)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 路由和自定义错误页面</span></span><br><span class="line">    <span class="keyword">from</span> src.site <span class="keyword">import</span> site</span><br><span class="line">    <span class="keyword">from</span> src.api <span class="keyword">import</span> api <span class="keyword">as</span> api_blueprint</span><br><span class="line">    <span class="keyword">from</span> src.admin <span class="keyword">import</span> admin <span class="keyword">as</span> admin_blueprint</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 访问时需要加上前缀</span></span><br><span class="line">    app.register_blueprint(site)</span><br><span class="line">    app.register_blueprint(api_blueprint, url_prefix=<span class="string">&#x27;/api/v1.0&#x27;</span>)</span><br><span class="line">    app.register_blueprint(admin_blueprint, url_prefix=<span class="string">&#x27;/admin&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> app</span><br></pre></td></tr></table></figure>

<p>修改 app.py</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># app.py</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> src <span class="keyword">import</span> create_app</span><br><span class="line"></span><br><span class="line">app = create_app(os.getenv(<span class="string">&#x27;FLASK_CONFIG&#x27;</span>) <span class="keyword">or</span> <span class="string">&#x27;default&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>, debug=<span class="literal">True</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>添加 404 和 500 出错页面</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># src/templates/404.html</span></span><br><span class="line"><span class="comment"># src/templates/500.html</span></span><br></pre></td></tr></table></figure>


<p>填写测试路由，注意这里需要访问 <a target="_blank" rel="noopener" href="http://127.0.0.1:5000/site">http://127.0.0.1:5000/site</a> ，因为蓝图里面添加了前缀</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># src/site/routes_site.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template, app</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> src.site <span class="keyword">import</span> site</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@site.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello world site&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@site.app_errorhandler(<span class="params"><span class="number">404</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">page_not_found</span>(<span class="params">e</span>):</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;404.html&#x27;</span>), <span class="number">404</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@site.app_errorhandler(<span class="params"><span class="number">500</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">internal_server_error</span>(<span class="params">e</span>):</span></span><br><span class="line">    <span class="keyword">import</span> traceback</span><br><span class="line">    traceback.print_exc()</span><br><span class="line">    errMsg = traceback.format_exc()</span><br><span class="line">    app.logger.exception(<span class="string">&#x27;error 500: %s&#x27;</span>, errMsg)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;500.html&#x27;</span>), <span class="number">500</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="打开调试选项"><a href="#打开调试选项" class="headerlink" title="打开调试选项"></a>打开调试选项</h2><img alt="20200603_220459.png" src="/2020/06/03/%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/flask/flask%E8%82%A1%E7%A5%A8%E9%A1%B9%E7%9B%AE001-%E5%BB%BA%E7%AB%8B%E9%A1%B9%E7%9B%AE/20200603_220459.png" width="400" height>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://zhengjun.top/2020/06/03/%E5%BC%80%E6%BA%90%E5%BA%93/Eigen/Eigen-Matrix-use/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="郑  君">
      <meta itemprop="description" content="C++，golang，Java，Python，Kotlin，区块链，全栈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="郑君的学习笔记">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/06/03/%E5%BC%80%E6%BA%90%E5%BA%93/Eigen/Eigen-Matrix-use/" class="post-title-link" itemprop="url">Eigen-Matrix use</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-06-03 11:03:06 / 修改时间：17:44:10" itemprop="dateCreated datePublished" datetime="2020-06-03T11:03:06+08:00">2020-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%BC%80%E6%BA%90%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">开源库</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%BC%80%E6%BA%90%E5%BA%93/c/" itemprop="url" rel="index"><span itemprop="name">c++</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>324</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Matrix 用来表示数学意义上的矩阵和向量，Array 用来表示 1D 和 2D 的数组</p>
<p>但在 Eigen 中 matrix 与 array 是有明确区别的，总的来说，Eigen 中的 matrix 与线性代数息息相关，它设计的初衷就是为了解决线性代数问题，例如解线性方程组、求矩阵特征值、矩阵的秩、QR分解等等。而 array 则负责系数运算，例如所有系数加上一个常数或者两个 array 系数相乘。</p>
<h2 id="Eigen-MatrixXf"><a href="#Eigen-MatrixXf" class="headerlink" title="Eigen::MatrixXf"></a>Eigen::MatrixXf</h2><p>float<br>Eigen::MatrixXf</p>
<p>double<br>Eigen::MatrixXd</p>
<p>int n = 12;<br>std::vector<double> Avec(n * n);<br>Eigen::Map<a href="Eigen::MatrixXd">Eigen::MatrixXd</a> A(Avec.data(), n, n);</double></p>
<p>testNistMGH17</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://zhengjun.top/2020/06/03/%E5%BC%80%E6%BA%90%E5%BA%93/Eigen/Eigen-nonlinear-least-square-fitting/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="郑  君">
      <meta itemprop="description" content="C++，golang，Java，Python，Kotlin，区块链，全栈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="郑君的学习笔记">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/06/03/%E5%BC%80%E6%BA%90%E5%BA%93/Eigen/Eigen-nonlinear-least-square-fitting/" class="post-title-link" itemprop="url">Eigen-nonlinear least square fitting</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-06-03 10:18:56" itemprop="dateCreated datePublished" datetime="2020-06-03T10:18:56+08:00">2020-06-03</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-06-09 16:00:36" itemprop="dateModified" datetime="2020-06-09T16:00:36+08:00">2020-06-09</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%BC%80%E6%BA%90%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">开源库</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%BC%80%E6%BA%90%E5%BA%93/c/" itemprop="url" rel="index"><span itemprop="name">c++</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.4k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>c++ 版本的 polyfit 和 numpy 同样的算法 Levenberg-Marquardt Optimization</p>
<p>折腾了 2 天，找到了一个讲的比较细致的文章，总算把问题解决了。</p>
<p>下面是参考原文：</p>
<p><a target="_blank" rel="noopener" href="https://medium.com/@sarvagya.vaish/levenberg-marquardt-optimization-part-1-981f5777b1d7">ref. part1</a><br><a target="_blank" rel="noopener" href="https://medium.com/@sarvagya.vaish/levenberg-marquardt-optimization-part-2-5a71f7db27a0">ref. part2</a></p>
<p>The Levenberg-Marquardt curve-fitting method is actually a combination of two minimization methods: the gradient descent method and the Gauss-Newton method.</p>
<p>fit 是拟合后的数据，measured 是原始数据<br><img alt="20200603_102846.png" src="/2020/06/03/%E5%BC%80%E6%BA%90%E5%BA%93/Eigen/Eigen-nonlinear-least-square-fitting/20200603_102846.png" width="500" height></p>
<p><a target="_blank" rel="noopener" href="https://eigen.tuxfamily.org/dox/unsupported/group__NonLinearOptimization__Module.html">Eigen’s non-linear optimization module</a></p>
<p>速度巨慢</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  PolyfitEigen.hpp</span></span><br><span class="line"><span class="comment">//  Polyfit</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by Patrick Löber on 23.11.18.</span></span><br><span class="line"><span class="comment">//  Copyright © 2018 Patrick Loeber. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Use the Eigen library for fitting: http://eigen.tuxfamily.org</span></span><br><span class="line"><span class="comment">//  See https://eigen.tuxfamily.org/dox/group__TutorialLinearAlgebra.html for different methods</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Eigen/Dense&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function">std::vector&lt;T&gt; <span class="title">polyfit_Eigen</span><span class="params">(<span class="keyword">const</span> std::vector&lt;T&gt; &amp;xValues, <span class="keyword">const</span> std::vector&lt;T&gt; &amp;yValues, <span class="keyword">const</span> <span class="keyword">int</span> degree, <span class="keyword">const</span> std::vector&lt;T&gt;&amp; weights = std::vector&lt;T&gt;(), <span class="keyword">bool</span> useJacobi = <span class="literal">true</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> Eigen;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">bool</span> useWeights = weights.<span class="built_in">size</span>() &gt; <span class="number">0</span> &amp;&amp; weights.<span class="built_in">size</span>() == xValues.<span class="built_in">size</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> numCoefficients = degree + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">size_t</span> nCount = xValues.<span class="built_in">size</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="function">MatrixXf <span class="title">X</span><span class="params">(nCount, numCoefficients)</span></span>;</span><br><span class="line">    <span class="function">MatrixXf <span class="title">Y</span><span class="params">(nCount, <span class="number">1</span>)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// fill Y matrix</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; nCount; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (useWeights)</span><br><span class="line">            <span class="built_in">Y</span>(i, <span class="number">0</span>) = yValues[i] * weights[i];</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">Y</span>(i, <span class="number">0</span>) = yValues[i];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// fill X matrix (Vandermonde matrix)</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> nRow = <span class="number">0</span>; nRow &lt; nCount; nRow++)</span><br><span class="line">    &#123;</span><br><span class="line">        T nVal = <span class="number">1.0f</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> nCol = <span class="number">0</span>; nCol &lt; numCoefficients; nCol++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (useWeights)</span><br><span class="line">                <span class="built_in">X</span>(nRow, nCol) = nVal * weights[nRow];</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">X</span>(nRow, nCol) = nVal;</span><br><span class="line">            nVal *= xValues[nRow];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    VectorXf coefficients;</span><br><span class="line">    <span class="comment">//雅可比方法(Jacobian method)</span></span><br><span class="line">    <span class="keyword">if</span> (useJacobi)</span><br><span class="line">        coefficients = X.<span class="built_in">jacobiSvd</span>(ComputeThinU | ComputeThinV).<span class="built_in">solve</span>(Y);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        coefficients = X.<span class="built_in">colPivHouseholderQr</span>().<span class="built_in">solve</span>(Y);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> std::vector&lt;T&gt;(coefficients.<span class="built_in">data</span>(), coefficients.<span class="built_in">data</span>() + numCoefficients);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> Calculates the value of a polynomial of degree n evaluated at x. The input</span></span><br><span class="line"><span class="comment"> argument coefficients is a vector of length n+1 whose elements are the coefficients</span></span><br><span class="line"><span class="comment"> in incremental powers of the polynomial to be evaluated.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> param:</span></span><br><span class="line"><span class="comment"> coefficients       polynomial coefficients generated by polyfit() function</span></span><br><span class="line"><span class="comment"> xValues            x axis values</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> return:</span></span><br><span class="line"><span class="comment"> Fitted Y values.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function">std::vector&lt;T&gt; <span class="title">polyval</span><span class="params">(<span class="keyword">const</span> std::vector&lt;T&gt;&amp; coefficients, <span class="keyword">const</span> std::vector&lt;T&gt;&amp; xValues)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">size_t</span> nCount = xValues.<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">size_t</span> nDegree = coefficients.<span class="built_in">size</span>();</span><br><span class="line">    <span class="function">std::vector&lt;T&gt; <span class="title">yValues</span><span class="params">(nCount)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; nCount; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        T yVal = <span class="number">0</span>;</span><br><span class="line">        T xPowered = <span class="number">1</span>;</span><br><span class="line">        T xVal = xValues[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">size_t</span> j = <span class="number">0</span>; j &lt; nDegree - <span class="number">1</span>; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            yVal += coefficients[j] * <span class="built_in">pow</span>(xVal, nDegree - <span class="number">1</span> - j);</span><br><span class="line">        &#125;</span><br><span class="line">        yValues[i] = yVal + coefficients[nDegree<span class="number">-1</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> yValues;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://zhengjun.top/2020/06/02/%E5%BC%80%E6%BA%90%E5%BA%93/dlib%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="郑  君">
      <meta itemprop="description" content="C++，golang，Java，Python，Kotlin，区块链，全栈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="郑君的学习笔记">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/06/02/%E5%BC%80%E6%BA%90%E5%BA%93/dlib%E5%AD%A6%E4%B9%A0/" class="post-title-link" itemprop="url">dlib学习</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-06-02 10:30:43 / 修改时间：11:08:04" itemprop="dateCreated datePublished" datetime="2020-06-02T10:30:43+08:00">2020-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%BC%80%E6%BA%90%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">开源库</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%BC%80%E6%BA%90%E5%BA%93/c/" itemprop="url" rel="index"><span itemprop="name">c++</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.8k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h2><p><a target="_blank" rel="noopener" href="http://dlib.net/">dlib</a></p>
<p>使用 cmake 生成 vs2019 项目</p>
<p>注意一下配置项符合自己的需求就可以了。</p>
<p>打开项目后，可以顺利的生成 debug 和 release 版本。</p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>使用时需要修改一个 dlib/config.h 文件，否则会提示 USER_ERROR__inconsistent_build_configuration__see_dlib_faq_2?</p>
<p>在 cmake 生成的 build 目录下面，也会有个 config.h 文件，参考里面的内容，根据自己的需要修改一下 dlib/config.h 文件</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// If you are compiling dlib as a shared library and installing it somewhere on your system</span></span><br><span class="line"><span class="comment">// then it is important that any programs that use dlib agree on the state of the</span></span><br><span class="line"><span class="comment">// DLIB_ASSERT statements (i.e. they are either always on or always off).  Therefore,</span></span><br><span class="line"><span class="comment">// uncomment one of the following lines to force all DLIB_ASSERTs to either always on or</span></span><br><span class="line"><span class="comment">// always off.  If you don&#x27;t define one of these two macros then DLIB_ASSERT will toggle</span></span><br><span class="line"><span class="comment">// automatically depending on the state of certain other macros, which is not what you want</span></span><br><span class="line"><span class="comment">// when creating a shared library.</span></span><br><span class="line"><span class="comment">//#define ENABLE_ASSERTS       // asserts always enabled </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DLIB_DISABLE_ASSERTS <span class="comment">// asserts always disabled </span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define DLIB_ISO_CPP_ONLY</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DLIB_NO_GUI_SUPPORT</span></span><br><span class="line"><span class="comment">//#define DLIB_ENABLE_STACK_TRACE</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// You should also consider telling dlib to link against libjpeg, libpng, libgif, fftw, CUDA, </span></span><br><span class="line"><span class="comment">// and a BLAS and LAPACK library.  To do this you need to uncomment the following #defines.</span></span><br><span class="line"><span class="comment">// #define DLIB_JPEG_SUPPORT</span></span><br><span class="line"><span class="comment">// #define DLIB_PNG_SUPPORT</span></span><br><span class="line"><span class="comment">// #define DLIB_GIF_SUPPORT</span></span><br><span class="line"><span class="comment">// #define DLIB_USE_FFTW</span></span><br><span class="line"><span class="comment">// #define DLIB_USE_BLAS</span></span><br><span class="line"><span class="comment">// #define DLIB_USE_LAPACK</span></span><br><span class="line"><span class="comment">// #define DLIB_USE_CUDA</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Define this so the code in dlib/test_for_odr_violations.h can detect ODR violations</span></span><br><span class="line"><span class="comment">// related to users doing bad things with config.h</span></span><br><span class="line"><span class="comment">//#define DLIB_NOT_CONFIGURED</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DLIB_CHECK_FOR_VERSION_MISMATCH DLIB_VERSION_MISMATCH_CHECK__EXPECTED_VERSION_19_19_0</span></span><br></pre></td></tr></table></figure>

<p>使用 最小二乘法 做曲线拟合</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;dlib/optimization.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> _DEBUG</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> _WIN64</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib,<span class="meta-string">&quot;dlib19.19.0_debug_64bit_msvc1925.lib&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib,<span class="meta-string">&quot;xx.lib&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> _WIN64</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib,<span class="meta-string">&quot;dlib19.19.0_minsizerel_64bit_msvc1925.lib&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib,<span class="meta-string">&quot;xx.lib&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://zhengjun.top/2020/06/01/%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/python-%E5%8F%91%E5%B8%83%E7%A8%8B%E5%BA%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="郑  君">
      <meta itemprop="description" content="C++，golang，Java，Python，Kotlin，区块链，全栈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="郑君的学习笔记">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/06/01/%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/python-%E5%8F%91%E5%B8%83%E7%A8%8B%E5%BA%8F/" class="post-title-link" itemprop="url">python-发布程序</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-06-01 13:25:03" itemprop="dateCreated datePublished" datetime="2020-06-01T13:25:03+08:00">2020-06-01</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-03-02 13:37:36" itemprop="dateModified" datetime="2021-03-02T13:37:36+08:00">2021-03-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Language/" itemprop="url" rel="index"><span itemprop="name">Language</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>注意 win7 需要 Windows6.1-KB2533623-x64.msu 补丁</p>
<p>打包为可执行文件以便分发。</p>
<p>PyInstaller – 将 Python 程序转换成独立的执行文件（跨平台）。<br>dh-virtualenv – 构建并将 virtualenv 虚拟环境作为一个 Debian 包来发布。<br>Nuitka – 将脚本、模块、包编译成可执行文件或扩展模块。<br>py2app – 将 Python 脚本变为独立软件包（Mac OS X）。<br>py2exe – 将 Python 脚本变为独立软件包（Windows）。<br>pynsist – 一个用来创建 Windows 安装程序的工具，可以在安装程序中打包 Python本身。</p>
<h2 id="Nuitka"><a href="#Nuitka" class="headerlink" title="Nuitka"></a>Nuitka</h2><p><a target="_blank" rel="noopener" href="http://nuitka.net/">website</a></p>
<p>Nuitka直接将python编译成C++代码 ,再编译C++代码产生可执行文件,完全不存在反向解析的问题，非常安全，而且由于可执行文件由C++编译而来，运行速度也会获得提升。</p>
<p>下载MinGW64 8.1(MinGW编译器比MSVS编译器要快，并且不需要下载一堆20多G的安装文件到C盘)</p>
<img alt="20200601_145914.png" src="/2020/06/01/%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/python-%E5%8F%91%E5%B8%83%E7%A8%8B%E5%BA%8F/20200601_145914.png" width="500" height>

<p>解压后放在C盘目录下，查询gcc.exe是否有效 gcc.exe –version </p>
<img alt="20200601_145936.png" src="/2020/06/01/%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/python-%E5%8F%91%E5%B8%83%E7%A8%8B%E5%BA%8F/20200601_145936.png" width="500" height>

<p>设置环境变量</p>
<img alt="20200601_145955.png" src="/2020/06/01/%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/python-%E5%8F%91%E5%B8%83%E7%A8%8B%E5%BA%8F/20200601_145955.png" width="500" height>

<p>查看相关信息<br>python -m nuitka –version<br>python -m nuitka –plugin-list</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pip install nuitka</span><br><span class="line">pip install -U nuitka</span><br><span class="line"></span><br><span class="line">使用 anaconda 安装</span><br><span class="line">conda install -c conda-forge nuitka</span><br><span class="line"></span><br><span class="line">使用 anaconda 安装 mingw64 更方便</span><br><span class="line">conda install m2w64-gcc libpython</span><br><span class="line">setenv CC=&lt;path_to_Anaconda&gt;\Library\mingw-w64\bin\gcc.exe </span><br><span class="line">set CC=D:\Anaconda3\envs\leastSquare\Library\mingw-w64\bin\gcc.exe </span><br><span class="line"></span><br><span class="line">然后使用 提示模式 自动设置参数</span><br><span class="line">python get-hints.py your.py</span><br><span class="line">python nuitka-hints.py your.py</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">手动设置参数</span><br><span class="line"></span><br><span class="line">setenv CC=C:\mingw64\bin\gcc.exe</span><br><span class="line">python -m nuitka --mingw64 --standalone --output-dir=out --show-progress   --plugin-enable=numpy --follow-imports app.py</span><br><span class="line"></span><br><span class="line">python nuitka --mingw64 --standalone  --show-modules  --show-progress --show-scons --plugin-enable=numpy --plugin-enable=tk-inter --plugin-enable=pylint-warnings  -j 8 main.py</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">python -m nuitka --mingw64 --standalone --windows-disable-console --python-flag=no_site --show-modules  --show-progress --show-scons --plugin-enable=numpy --plugin-enable=tk-inter --plugin-enable=pylint-warnings --assume-yes-for-downloads  --nofollow-import-to=numpy,jinja2,matplotlib,scipy,sqlalchemy,pandas,pygal,pyzbar --follow-import-to=tkArc -j 8 app.py</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--show-scons </span><br><span class="line"></span><br><span class="line">python -m nuitka --mingw64 --standalone  --show-progress --plugin-enable=numpy --plugin-enable=tk-inter --plugin-enable=pylint-warnings --plugin-enable=qt-plugins --assume-yes-for-downloads --nofollow-imports --follow-import-to=numpy,matplotlib app.py</span><br><span class="line"></span><br><span class="line">遇到缺少库文件的就找到文件拷贝过去，有目录的考目录，有.py文件的拷文件</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 下面的编译时间非常的长超过8小时</span></span><br><span class="line">nuitka --mingw64 --standalone --show-progress --plugin-enable=numpy --plugin-enable=tk-inter --plugin-enable=pylint-warnings --plugin-enable=qt-plugins --assume-yes-for-downloads  --recurse-all main.py</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> --nofollow-imports --follow-import-to=numpy,matplotlib</span><br><span class="line"></span><br><span class="line">--recurse-all  如同pyinstaller 的--onefile 将所有文件打包为一个可执行程序。</span><br><span class="line">--output-dir=out</span><br><span class="line">--windows-dependency-tool=pefile</span><br><span class="line">--follow-imports </span><br><span class="line">--python-flag=nosite </span><br><span class="line">--file-reference-choice=original</span><br><span class="line"></span><br><span class="line">--python-flag=no_site</span><br><span class="line"></span><br><span class="line">--mingw64 #默认为已经安装的vs2017去编译，否则就按指定的比如mingw</span><br><span class="line">--standalone 不依赖安装的python文件，这是必须的</span><br><span class="line">--windows-dependency-tool=pefile 查找依赖库</span><br><span class="line">--windows-disable-console 没有CMD控制窗口</span><br><span class="line">--recurse-all 所有的资源文件 这个也选上</span><br><span class="line">-recurse-not-to=numpy,jinja2 不编译的模块，防止速度会更慢</span><br><span class="line">--output-dir=out 生成exe到out文件夹下面去</span><br><span class="line">--show-progress 显示编译的进度，很直观</span><br><span class="line">--show-memory 显示内存的占用</span><br><span class="line">--plugin-enable=pylint-warnings 报警信息</span><br><span class="line">--plugin-enable=qt-plugins 需要加载的PyQT插件</span><br><span class="line"></span><br><span class="line">-o: 指定输出的文件名（需包含所在目录）</span><br></pre></td></tr></table></figure>

<h3 id="编译-pyd"><a href="#编译-pyd" class="headerlink" title="编译 pyd"></a>编译 pyd</h3><p>如果 pyd 调用有问题，可以尝试一下 cpython 生成 pyd</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nuitka --mingw64 --module --show-progress --output-dir=o 你的.py</span><br></pre></td></tr></table></figure>

<h2 id="pyinstaller"><a href="#pyinstaller" class="headerlink" title="pyinstaller"></a>pyinstaller</h2><p>pip install pyinstaller</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pyinstaller -y --upx-dir E:\green\upx-3.96-win64\ --clean --onefile MainWindow.py </span><br><span class="line"></span><br><span class="line">pyinstaller -y --clean --onefile  --distpath ../dist --workpath ../build app.py </span><br><span class="line">pyinstaller -y --clean  --distpath ../dist --workpath ../build app.py </span><br></pre></td></tr></table></figure>

<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>Could not find the matplotlib data files</p>
<p>当前版本 3.3.7 降级据说可以<br>pip install matplotlib==3.0.3  -i <a target="_blank" rel="noopener" href="https://pypi.tuna.tsinghua.edu.cn/simple">https://pypi.tuna.tsinghua.edu.cn/simple</a> –user<br>pip install matplotlib==3.1.3<br>pip install matplotlib==3.2.2</p>
<h3 id="No-module-named-‘TkTreectrl’"><a href="#No-module-named-‘TkTreectrl’" class="headerlink" title="No module named ‘TkTreectrl’"></a>No module named ‘TkTreectrl’</h3><h3 id="tkinter-TclError-Can’t-find-a-usable-init-tcl"><a href="#tkinter-TclError-Can’t-find-a-usable-init-tcl" class="headerlink" title="_tkinter.TclError: Can’t find a usable init.tcl"></a>_tkinter.TclError: Can’t find a usable init.tcl</h3>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://zhengjun.top/2020/05/30/%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/CPP/cpp-embedded-python/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="郑  君">
      <meta itemprop="description" content="C++，golang，Java，Python，Kotlin，区块链，全栈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="郑君的学习笔记">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/30/%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/CPP/cpp-embedded-python/" class="post-title-link" itemprop="url">cpp-embedded python</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-05-30 15:44:52" itemprop="dateCreated datePublished" datetime="2020-05-30T15:44:52+08:00">2020-05-30</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-06-01 17:39:30" itemprop="dateModified" datetime="2020-06-01T17:39:30+08:00">2020-06-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/c/" itemprop="url" rel="index"><span itemprop="name">c++</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>34</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a href>pybind11</a></p>
<p>目前 python3 在软件退出时会有内存泄漏，暂不使用</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/23/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/23/">23</a><span class="page-number current">24</span><a class="page-number" href="/page/25/">25</a><span class="space">&hellip;</span><a class="page-number" href="/page/129/">129</a><a class="extend next" rel="next" href="/page/25/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2017 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">郑  君</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">2.1m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">31:19</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script><script src="/js/code-unfold.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>



  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
